# game-timer Specification

## Purpose
TBD - created by archiving change add-game-timer. Update Purpose after archive.
## Requirements
### Requirement: 倒计时显示
系统 SHALL 在游戏页面显示倒计时，格式为 MM:SS（分钟:秒）。

#### Scenario: 显示倒计时
- **WHEN** 用户进入游戏页面并开始游戏
- **THEN** 在游戏页面顶部显示倒计时组件
- **AND** 倒计时格式为 MM:SS（例如：04:59）
- **AND** 倒计时每秒更新一次

#### Scenario: 倒计时视觉警告
- **WHEN** 倒计时剩余时间少于1分钟
- **THEN** 倒计时文字颜色变为红色
- **AND** 提供视觉警告提示用户时间紧迫

### Requirement: 倒计时自动启动
系统 SHALL 在游戏开始时自动启动倒计时。

#### Scenario: 游戏开始时启动倒计时
- **WHEN** 用户开始新游戏（点击"开始游戏"或自动开始）
- **THEN** 倒计时自动从设置的时长开始倒计时
- **AND** 倒计时每秒递减

#### Scenario: 首页不启动倒计时
- **WHEN** 用户在首页
- **THEN** 倒计时不启动
- **AND** 即使设置了倒计时，首页也不显示或运行倒计时

### Requirement: 倒计时重置
系统 SHALL 在每次新游戏开始时重置倒计时。

#### Scenario: 开始新游戏时重置
- **WHEN** 用户开始新游戏（点击"再来一局"或重新开始）
- **THEN** 倒计时重置为设置的时长
- **AND** 倒计时重新开始计时

#### Scenario: 修改设置时重置
- **WHEN** 用户在游戏进行中修改倒计时设置
- **THEN** 倒计时立即重置为新设置的值
- **AND** 倒计时重新开始计时

### Requirement: 倒计时停止
系统 SHALL 在游戏成功或失败时停止倒计时。

#### Scenario: 游戏成功时停止
- **WHEN** 用户猜对答案，游戏成功
- **THEN** 倒计时立即停止
- **AND** 倒计时显示最终剩余时间

#### Scenario: 游戏失败时停止
- **WHEN** 用户用尽尝试次数，游戏失败
- **THEN** 倒计时立即停止
- **AND** 倒计时显示最终剩余时间

### Requirement: 双重限制机制
系统 SHALL 实现倒计时和尝试次数双重限制，任一触发即判定游戏失败。

#### Scenario: 倒计时结束时
- **WHEN** 倒计时归零（00:00）
- **THEN** 游戏自动判定为失败
- **AND** 设置 `gameOver = true`
- **AND** 停止倒计时
- **AND** 显示超时提示弹框

#### Scenario: 尝试次数用尽时
- **WHEN** 用户用尽最大尝试次数
- **THEN** 游戏自动判定为失败
- **AND** 设置 `gameOver = true`
- **AND** 停止倒计时（如果还在运行）
- **AND** 显示失败提示

### Requirement: 倒计时超时处理
系统 SHALL 在倒计时结束时自动判定游戏失败并显示提示。

#### Scenario: 超时弹框内容
- **WHEN** 倒计时结束，显示超时弹框
- **THEN** 弹框标题显示"时间到"
- **AND** 弹框内容提示用户时间已用完
- **AND** 弹框提供两个按钮：
  - "再来一局"：重新开始游戏
  - "回到首页"：返回首页

#### Scenario: 超时后选择再来一局
- **WHEN** 用户在超时弹框中选择"再来一局"
- **THEN** 关闭弹框
- **AND** 调用游戏的重置函数（`restartGame()`）
- **AND** 倒计时重置并重新开始

#### Scenario: 超时后选择回到首页
- **WHEN** 用户在超时弹框中选择"回到首页"
- **THEN** 关闭弹框
- **AND** 导航到首页（`router.push('/')`）
- **AND** 停止倒计时

### Requirement: 页面可见性处理
系统 SHALL 在用户切换到其他标签页时暂停倒计时，返回时恢复。

#### Scenario: 切换标签页
- **WHEN** 用户切换到其他浏览器标签页
- **THEN** 倒计时暂停
- **AND** 倒计时状态保持（不继续递减）

#### Scenario: 返回标签页
- **WHEN** 用户返回游戏标签页
- **THEN** 倒计时恢复运行
- **AND** 从暂停时的剩余时间继续倒计时

### Requirement: 倒计时状态恢复
系统 SHALL 在页面刷新后恢复倒计时状态，从暂停时的剩余时间继续。

#### Scenario: 刷新页面后恢复倒计时
- **WHEN** 用户在游戏进行中刷新页面
- **THEN** 系统从 sessionStorage 读取倒计时状态
- **AND** 如果存在状态，恢复倒计时从剩余时间继续
- **AND** 显示3秒悬浮提示："倒计时已恢复，剩余时间：XX:XX，或者看广告延长时间，QAQ骗你的没广告~"

#### Scenario: 倒计时恢复提示显示
- **WHEN** 倒计时从 sessionStorage 恢复
- **THEN** 在页面顶部居中显示悬浮提示
- **AND** 提示宽度约占屏幕40%
- **AND** 提示背景为蓝色，带有前置感叹号图标
- **AND** 提示使用渐变出现和隐藏动画
- **AND** 提示自动显示3秒后消失

### Requirement: 游戏集成
系统 SHALL 在城市猜测和英雄猜测游戏中集成倒计时功能，并读取配置值。

#### Scenario: 城市猜测游戏集成
- **WHEN** 用户进入城市猜测游戏
- **THEN** 系统读取城市猜测的配置（优先使用覆盖值，否则使用全局默认值）
- **AND** 游戏页面显示倒计时组件
- **AND** 游戏开始时倒计时自动启动（使用配置的时长）
- **AND** 游戏使用配置的最大尝试次数（不再固定为5次）
- **AND** 倒计时结束时游戏判定失败

#### Scenario: 英雄猜测游戏集成
- **WHEN** 用户进入英雄猜测游戏
- **THEN** 系统读取英雄猜测的配置（优先使用覆盖值，否则使用全局默认值）
- **AND** 游戏页面显示倒计时组件
- **AND** 游戏开始时倒计时自动启动（使用配置的时长）
- **AND** 游戏使用配置的最大尝试次数（不再固定为5次）
- **AND** 倒计时结束时游戏判定失败

### Requirement: 倒计时开关控制
游戏倒计时功能 SHALL 支持通过配置开关启用或禁用，允许用户选择是否使用倒计时模式。

#### Scenario: 倒计时开关开启时显示倒计时
- **GIVEN** 游戏配置中 `enableTimer` 为 `true`
- **WHEN** 游戏开始
- **THEN** 显示倒计时组件
- **AND** 倒计时正常运行
- **AND** 倒计时结束时触发游戏失败

#### Scenario: 倒计时开关关闭时不显示倒计时
- **GIVEN** 游戏配置中 `enableTimer` 为 `false`
- **WHEN** 游戏开始
- **THEN** 不显示倒计时组件
- **AND** 游戏不受时间限制
- **AND** 用户可以无限时间内完成游戏

#### Scenario: 游戏类型覆盖全局设置
- **GIVEN** 全局默认设置 `enableTimer` 为 `true`
- **AND** 电影游戏覆盖设置 `enableTimer` 为 `false`
- **WHEN** 进入电影猜测游戏
- **THEN** 倒计时不显示（使用覆盖设置）
- **WHEN** 进入城市猜测游戏
- **THEN** 倒计时显示（使用全局默认）

#### Scenario: 倒计时关闭时不保存倒计时状态
- **GIVEN** 游戏配置中 `enableTimer` 为 `false`
- **WHEN** 游戏进行中
- **THEN** 不保存倒计时相关状态到 localStorage
- **AND** 页面刷新后游戏状态正常恢复（不包含倒计时）

