# settings-admin Specification

## Purpose
TBD - created by archiving change refactor-settings-admin. Update Purpose after archive.
## Requirements
### Requirement: 管理员配置入口
系统 SHALL 提供管理员配置入口页面，以卡片式布局展示所有可配置的游戏。

#### Scenario: 访问配置入口
- **WHEN** 管理员访问 `/settings` 路径
- **THEN** 系统显示卡片式布局页面
- **AND** 页面包含标题"游戏配置管理"
- **AND** 展示 2-3 列游戏卡片（响应式布局）

#### Scenario: 游戏卡片展示
- **WHEN** 管理员查看配置入口页面
- **THEN** 每个游戏卡片显示游戏名称、图标、简短描述
- **AND** 卡片支持 hover 状态视觉反馈
- **AND** 点击卡片可进入对应游戏的配置页面

#### Scenario: 快捷隐藏游戏
- **WHEN** 管理员将鼠标悬停在游戏卡片上
- **THEN** 卡片右上角显示眼睛图标（可见）或斜杠眼睛图标（隐藏）
- **AND** 点击图标可切换该游戏在首页的显示/隐藏状态
- **AND** 隐藏的游戏卡片显示为半透明样式

### Requirement: 游戏首页可见性控制
系统 SHALL 根据管理员配置的可见性设置，控制游戏在首页的显示与隐藏。

#### Scenario: 首页过滤隐藏的游戏
- **WHEN** 玩家访问首页
- **THEN** 系统读取游戏可见性配置
- **AND** 仅显示设置为"可见"的游戏卡片
- **AND** 隐藏的游戏不在首页展示

#### Scenario: 可见性状态持久化
- **WHEN** 管理员切换游戏的可见性状态
- **THEN** 状态立即保存到本地存储
- **AND** 刷新页面后状态保持不变

### Requirement: 游戏独立配置页面
系统 SHALL 为每个游戏提供独立的配置页面，包含游戏参数设置和数据管理两部分。

#### Scenario: 进入游戏配置页面
- **WHEN** 管理员点击某个游戏卡片
- **THEN** 路由跳转到 `/settings/:gameType`（如 `/settings/city`）
- **AND** 页面显示该游戏的配置选项
- **AND** 页面提供返回配置入口的导航

#### Scenario: 配置页面结构
- **WHEN** 管理员查看游戏配置页面
- **THEN** 页面分为"游戏参数"和"数据管理"两个区域
- **AND** "游戏参数"区域包含倒计时、尝试次数等设置
- **AND** "数据管理"区域包含游戏数据的 CRUD 操作入口

### Requirement: 游戏参数配置
系统 SHALL 允许管理员为每个游戏独立配置游戏参数，无全局默认设置。

#### Scenario: 配置倒计时
- **WHEN** 管理员在游戏配置页面设置倒计时
- **THEN** 可以启用/禁用倒计时功能
- **AND** 可以设置倒计时时长（1-60 分钟）
- **AND** 设置即时保存到本地存储

#### Scenario: 配置尝试次数
- **WHEN** 管理员设置最大尝试次数
- **THEN** 可以设置尝试次数（3-10 次）
- **AND** 设置即时保存到本地存储

#### Scenario: 配置初始提示
- **WHEN** 管理员设置初始提示选项
- **THEN** 可以启用/禁用显示初始提示
- **AND** 设置即时保存到本地存储

### Requirement: 数据 Schema 定义
系统 SHALL 为每种游戏数据定义 Schema，描述数据结构和验证规则。

#### Scenario: 城市数据 Schema
- **WHEN** 系统定义城市数据 Schema
- **THEN** 包含字段：name（必填）、aliases（数组）、latitude（必填）、longitude（必填）、features（数组）
- **AND** 主键为 name 字段
- **AND** 每个字段有对应的类型和验证规则

#### Scenario: 英雄数据 Schema
- **WHEN** 系统定义英雄数据 Schema
- **THEN** 包含字段：name（必填）、role、era、nationality、human、gender
- **AND** 主键为 name 字段
- **AND** role、era、nationality、human、gender 为选择类型字段

#### Scenario: 电影数据 Schema
- **WHEN** 系统定义电影数据 Schema
- **THEN** 包含字段：id、name（必填）、nameVariants（数组）、hint、duration
- **AND** 主键为 id 字段
- **AND** 每个字段有对应的类型和验证规则

#### Scenario: 听歌识曲数据 Schema
- **WHEN** 系统定义听歌识曲数据 Schema
- **THEN** 包含字段：id、lyrics（必填）、answer（必填）、audioClip、lang、rate、pitch、hints
- **AND** 主键为 id 字段，默认为自增或 UUID
- **AND** `lyrics`、`answer` 为字符串类型并限制长度不超过 200 字符
- **AND** `audioClip` 使用文件选择器并存储为 IndexedDB File 引用，单个文件大小不超过 5MB
- **AND** `lang`、`rate`、`pitch` 为可选参数并提供默认值（如 `zh-CN`、1.0、1.0）
- **AND** `hints` 为字符串数组，最多允许 5 条提示

### Requirement: 数据管理界面
系统 SHALL 提供基于 Schema 的数据管理界面，支持数据的增删改查。

#### Scenario: 查看数据列表
- **WHEN** 管理员进入数据管理区域
- **THEN** 系统以表格形式展示当前使用的数据
- **AND** 表格显示数据的关键字段（基于 Schema 定义）
- **AND** 支持搜索和分页功能

#### Scenario: 新增数据
- **WHEN** 管理员点击"新增"按钮
- **THEN** 弹出数据编辑表单（弹窗形式）
- **AND** 表单字段基于 Schema 自动生成
- **AND** 提交时进行 Schema 验证
- **AND** 验证通过后保存数据

#### Scenario: 编辑数据
- **WHEN** 管理员点击某条数据的"编辑"按钮
- **THEN** 弹出预填充的数据编辑表单
- **AND** 管理员修改后提交
- **AND** 验证通过后更新数据

#### Scenario: 删除数据
- **WHEN** 管理员点击某条数据的"删除"按钮
- **THEN** 系统显示确认对话框
- **AND** 确认后删除该条数据
- **AND** 更新数据列表显示

### Requirement: 默认数据与自定义数据
系统 SHALL 提供预设的默认数据，并允许管理员在此基础上自定义。

#### Scenario: 使用默认数据
- **WHEN** 管理员首次进入配置页面
- **THEN** 数据列表显示系统预设的默认数据
- **AND** 显示"使用默认数据"状态
- **AND** 管理员可以切换为"使用自定义数据"

#### Scenario: 切换到自定义数据
- **WHEN** 管理员切换为"使用自定义数据"
- **THEN** 系统将默认数据复制为自定义数据
- **AND** 管理员可以在此基础上增删改查
- **AND** 游戏将使用自定义数据

#### Scenario: 重置为默认数据
- **WHEN** 管理员点击"重置为默认数据"
- **THEN** 系统显示确认对话框（警告将丢失自定义数据）
- **AND** 确认后清除自定义数据
- **AND** 切换回使用默认数据

### Requirement: 配置项展示形式
系统 SHALL 根据配置项复杂度采用不同的展示形式。

#### Scenario: 简单配置直接显示
- **WHEN** 配置项为简单开关或数值
- **THEN** 直接在配置页面显示
- **AND** 支持即时交互和保存

#### Scenario: 复杂配置折叠显示
- **WHEN** 配置项为复杂设置（如时间范围选择）
- **THEN** 使用折叠面板形式展示
- **AND** 默认收起，点击展开

#### Scenario: 数据管理弹窗显示
- **WHEN** 进行数据的新增或编辑
- **THEN** 使用弹窗形式展示表单
- **AND** 弹窗支持关闭和提交操作

### Requirement: 数据验证
系统 SHALL 在数据保存前进行 Schema 验证。

#### Scenario: 验证必填字段
- **WHEN** 管理员提交数据表单
- **THEN** 系统检查所有必填字段
- **AND** 如有缺失，显示错误提示
- **AND** 阻止保存并高亮错误字段

#### Scenario: 验证字段格式
- **WHEN** 字段有格式验证规则
- **THEN** 系统检查字段值是否符合规则
- **AND** 如不符合，显示具体错误信息

#### Scenario: 验证唯一性
- **WHEN** 新增数据的主键与已有数据重复
- **THEN** 系统显示"数据已存在"错误
- **AND** 阻止保存

### Requirement: 配置持久化
系统 SHALL 将配置和自定义数据持久化到本地存储。

#### Scenario: 自动保存配置
- **WHEN** 管理员修改游戏参数配置
- **THEN** 系统自动保存到 localStorage
- **AND** 无需手动点击保存按钮

#### Scenario: 加载已保存配置
- **WHEN** 管理员再次访问配置页面
- **THEN** 系统从 localStorage 加载已保存的配置
- **AND** 恢复上次的配置状态

#### Scenario: 存储容量监控
- **WHEN** 自定义数据量较大
- **THEN** 系统监控 localStorage 使用量
- **AND** 接近限制时显示警告提示

### Requirement: 数据过期机制
系统 SHALL 支持自定义数据的自动过期清除，过期天数可配置；数据过期天数的配置入口 SHALL 在设置页面主体内提供，不在右下角单独提供仅含数据过期的悬浮面板。

#### Scenario: 配置过期天数
- **WHEN** 管理员在设置中修改数据过期天数
- **THEN** 可设置范围为 1-365 天
- **AND** 默认值为 30 天
- **AND** 设置立即保存

#### Scenario: 数据过期配置入口在设置页面内
- **WHEN** 管理员查看设置页面
- **THEN** 数据过期天数在「年会/活动」配置入口内的区块中配置（与随机奖惩、随机抽人同属该入口）
- **AND** 不在右下角单独提供仅含「数据过期设置」的悬浮面板

#### Scenario: 数据过期检查
- **WHEN** 应用启动或管理员访问配置页面
- **THEN** 系统检查每个游戏的自定义数据是否过期
- **AND** 过期判断基于数据的最后修改时间 + 过期天数

#### Scenario: 过期数据清除
- **WHEN** 检测到自定义数据已过期
- **THEN** 系统自动清除该游戏的自定义数据
- **AND** 游戏恢复使用默认数据
- **AND** 显示提示通知管理员数据已过期清除

### Requirement: 配置变更生效时机
系统 SHALL 确保配置变更在下一局游戏开始时生效，不影响进行中的游戏。

#### Scenario: 配置变更不影响进行中游戏
- **WHEN** 管理员修改游戏配置（如尝试次数）
- **AND** 有玩家正在进行该游戏
- **THEN** 进行中的游戏保持原有配置不变
- **AND** 新开始的游戏使用新配置

#### Scenario: 数据删除不影响进行中游戏
- **WHEN** 管理员删除某条游戏数据（如删除某城市）
- **AND** 有玩家当前游戏的目标正是该数据
- **THEN** 进行中的游戏不受影响，可正常完成
- **AND** 新游戏不会选中已删除的数据

### Requirement: 一键重置功能
系统 SHALL 提供一键重置为默认数据的功能。

#### Scenario: 重置单个游戏数据
- **WHEN** 管理员在游戏配置页面点击"重置为默认数据"
- **THEN** 系统显示确认对话框，警告将丢失自定义数据
- **AND** 确认后清除该游戏的所有自定义数据
- **AND** 游戏恢复使用系统预设的默认数据

#### Scenario: 重置后状态
- **WHEN** 重置操作完成后
- **THEN** 数据列表显示默认数据
- **AND** 数据模式切换为"使用默认数据"
- **AND** 显示成功提示

### Requirement: 响应式设计
系统 SHALL 提供完全响应式的管理界面，移动端支持完整的数据管理操作。

#### Scenario: 移动端表格显示
- **WHEN** 管理员在移动设备上查看数据表格
- **THEN** 表格支持横向滚动
- **AND** 关键操作按钮保持可见
- **AND** 触摸操作友好

#### Scenario: 移动端弹窗表单
- **WHEN** 管理员在移动设备上新增/编辑数据
- **THEN** 弹窗适配屏幕宽度（接近全屏）
- **AND** 表单字段垂直排列
- **AND** 支持触摸滚动

#### Scenario: 移动端卡片布局
- **WHEN** 管理员在移动设备上访问配置入口
- **THEN** 游戏卡片切换为单列布局
- **AND** 快捷操作图标始终可见（无需 hover）

### Requirement: 导航入口设计
系统 SHALL 在导航栏仅显示齿轮图标作为管理入口，不显示文字。

#### Scenario: 齿轮图标入口
- **WHEN** 用户查看导航栏
- **THEN** 显示齿轮图标作为管理入口
- **AND** 不显示"设置"或"管理"等文字
- **AND** 点击图标跳转到 `/settings` 页面

### Requirement: 数据容量显示与限制
系统 SHALL 显示当前数据容量状态，并在达到上限时阻止新增。

#### Scenario: 显示容量状态
- **WHEN** 管理员在数据管理区域查看数据
- **THEN** 显示当前数据条数和上限（如"320/500 条"）
- **AND** 容量状态实时更新

#### Scenario: 达到上限阻止新增
- **WHEN** 数据条数已达 500 条上限
- **THEN** "新增"按钮显示为禁用状态
- **AND** 显示提示"已达 500 条上限，请删除部分数据后再添加"

### Requirement: 全量 JSON 导入导出
系统 SHALL 支持游戏数据的全量 JSON 导入和导出功能。

#### Scenario: 导出 JSON
- **WHEN** 管理员点击"导出 JSON"按钮
- **THEN** 系统将当前游戏的全部数据导出为 JSON 文件
- **AND** 文件名包含游戏类型和时间戳（如 `city-data-20260126.json`）
- **AND** JSON 格式美化，便于阅读和编辑

#### Scenario: 导入 JSON
- **WHEN** 管理员点击"导入 JSON"按钮
- **THEN** 系统打开文件选择器
- **AND** 管理员选择 JSON 文件后，系统解析并验证数据
- **AND** 验证通过后显示预览和确认对话框

#### Scenario: 导入数据验证
- **WHEN** 系统解析导入的 JSON 文件
- **THEN** 检查 JSON 格式是否正确
- **AND** 检查数据是否符合 Schema 定义
- **AND** 检查数据条数是否超过 500 条上限
- **AND** 验证失败时显示具体错误信息

#### Scenario: 导入确认与覆盖
- **WHEN** 导入数据验证通过
- **THEN** 显示确认对话框，警告将覆盖现有自定义数据
- **AND** 显示即将导入的数据条数
- **AND** 确认后替换现有数据并切换为"使用自定义数据"模式

### Requirement: 自定义数据初始化策略
系统 SHALL 在切换到自定义数据模式时，复制全部默认数据作为起点。

#### Scenario: 切换到自定义数据
- **WHEN** 管理员将数据模式从"使用默认数据"切换为"使用自定义数据"
- **THEN** 系统将全部默认数据复制为自定义数据
- **AND** 显示提示"已复制 N 条默认数据，您可以在此基础上进行修改"
- **AND** 管理员可以在复制的数据基础上增删改查

### Requirement: 年会活动配置入口
系统 SHALL 在设置页面提供一张「年会/活动」配置卡片（与各游戏配置卡片并列）；点击该卡片进入后，在同一页或子页内提供数据过期、随机奖惩、随机抽人三个配置区块（可折叠或 Tab）。

#### Scenario: 进入年会活动配置
- **WHEN** 管理员在设置页面点击「年会/活动」配置卡片
- **THEN** 进入年会活动配置视图
- **AND** 视图中包含数据过期、随机奖惩、随机抽人三个区块（可折叠或 Tab 切换）

#### Scenario: 与游戏卡片并列
- **WHEN** 管理员查看设置页面
- **THEN** 「年会/活动」卡片与各游戏配置卡片在同一网格中展示
- **AND** 卡片风格与入口交互与游戏卡片一致

### Requirement: 随机奖惩配置
系统 SHALL 在设置页面提供随机奖惩配置，支持配置多条奖励与惩罚条目；奖惩共用一个列表，每条带类型（奖励/惩罚）与文字描述；抽奖时 3 张从该列表纯随机抽取。

#### Scenario: 配置奖励与惩罚条目
- **WHEN** 管理员在年会活动配置中进入随机奖惩配置区块
- **THEN** 可新增、编辑、删除奖励条目与惩罚条目
- **AND** 每条条目包含类型（奖励/惩罚）与文字描述（如「唱一首歌」「做 10 个俯卧撑」）
- **AND** 配置即时保存到本地存储

#### Scenario: 表格内用 tag 区分类型
- **WHEN** 管理员在随机奖惩配置中查看条目列表（表格形式）
- **THEN** 奖励条目以绿色 tag 展示类型，惩罚条目以红色 tag 展示类型
- **AND** 便于一眼区分奖励与惩罚

#### Scenario: 奖惩列表用于抽奖
- **WHEN** 用户通过全局浮动入口触发「奖惩」抽奖
- **THEN** 系统从已配置的奖惩列表中随机选取条目用于卡牌展示
- **AND** 未配置或列表为空时，行为由实现定义（如提示先配置或使用默认占位）

### Requirement: 随机抽人配置
系统 SHALL 在设置页面提供随机抽人配置，支持人员名单的增删改查。

#### Scenario: 配置人员名单
- **WHEN** 管理员在年会活动配置中进入随机抽人配置区块
- **THEN** 可新增、编辑、删除人员名单条目（如姓名）
- **AND** 名单即时保存到本地存储

#### Scenario: 人员名单用于抽人
- **WHEN** 用户通过全局浮动入口触发「抽人」抽奖
- **THEN** 系统从已配置的人员名单中随机选取用于卡牌展示
- **AND** 未配置或名单为空时，行为由实现定义（如提示先配置或使用默认占位）

