# Design: 全局年会浮动装置与抽奖/奖惩动效

## Context

- 项目为前端年会游戏平台，无后端；配置与名单均存本地（localStorage/IndexedDB）。
- 当前仅 Settings 页右下角有「数据过期」悬浮面板，需改为全局统一浮动入口，并新增抽人/奖惩能力与卡牌动效。
- 产品要求：配置在 Settings 内完成；全局右下角单一圆形主图标，hover 弧形展开子入口；抽人/奖惩通过蒙版 + 卡牌轮播与翻牌动效呈现。

## Goals / Non-Goals

- **Goals**：将装置能力收口到 Settings；Settings 支持随机奖惩与随机抽人配置；全局右下角圆形主图标 + hover 弧形子图标；抽人/奖惩蒙版与卡牌动效（轮播 → 选一张 → 三张翻开，选中高亮）；动效可维护、使用成熟库。
- **Non-Goals**：不实现后端同步、多端实时同步；不在本设计内规定具体 Lottie 资源或品牌视觉规范。

## Decisions

### 1. 数据过期配置入口

- **决策**：数据过期天数配置从右下角悬浮面板迁移到 Settings 页面主体内（例如独立「数据与存储」卡片或与其它全局配置同一区域）。
- **理由**：装置能力统一在 Settings 中管理，右下角仅保留全局快捷入口（奖惩/抽人），避免同一页面存在两套「设置」入口。
- **备选**：保留右下角面板并同时提供页面内入口 — 易造成重复入口，不采纳。

### 2. 随机奖惩与随机抽人数据模型与存储

- **决策**：奖惩条目与人员名单均存本地（与现有 storageUtils 策略一致）。奖惩条目结构至少包含：类型（奖励/惩罚）、文字描述；人员名单为字符串列表（姓名），可扩展为带 id 的列表以便后续扩展。
- **理由**：与项目「纯前端、本地存储」约束一致；Schema 简单便于 Settings 表单与抽奖逻辑复用。
- **备选**：不持久化、仅内存 — 不符合「管理员提前配置」场景，不采纳。

### 3. 全局浮动组件挂载位置

- **决策**：在根布局（如 `App.vue`）中挂载「全局右下角浮动组件」，使其在所有路由下可见；蒙版与卡牌动效可为同一组件内状态或独立全局组件，通过 provide/inject 或 Pinia/状态管理触发显示。
- **理由**：抽人/奖惩需在任意页面可用，且蒙版需覆盖全屏，根级挂载最直接。
- **备选**：仅在 Settings 页挂载 — 与「全局」需求不符，不采纳。

### 4. 弧形子图标交互

- **决策**：主图标为圆形按钮；hover 后子图标以弧形（或滚轮式）排列在主图标周围，点击子图标触发对应能力（抽人/奖惩）；子图标至少包含「奖惩」「抽人」两个入口，扩展时可在同一弧形上增加入口。
- **理由**：与需求「滚轮式呈现多个新 icon 悬浮、弧形环绕」一致；实现可用 CSS transform 或 GSAP 做弧线定位与动画。
- **备选**：下拉菜单 — 不符合「弧形环绕」描述，不采纳。

### 5. 抽奖卡牌动效与库选型

- **决策**：采用 GSAP 驱动卡牌轮播、翻牌与高亮动效；Lottie 可作为补充（如卡牌背面/正面装饰、氛围动效），非必须。优先用 GSAP 保证时序与交互可控，Lottie 用于可选装饰。
- **理由**：GSAP 适合序列化、可编程的 UI 动效（轮播 → 定格 → 点击 → 翻牌 → 高亮）；Lottie 适合设计师输出的复杂矢量动效；二者可并存，推荐先 GSAP 打通流程再按需加 Lottie。
- **备选**：仅用 CSS — 复杂序列与多状态切换可维护性差；仅用 Lottie 驱动主流程 — 与「用户点击选一张」等交互耦合复杂，不采纳为主方案。

### 6. 蒙版与关闭

- **决策**：抽人/奖惩流程均在全局蒙版内进行；蒙版右上角提供关闭控件（叉号），点击后关闭蒙版并结束当前流程。
- **理由**：与需求「全局出现蒙版（右上角叉号）」一致；避免无出口的全屏状态。

## Risks / Trade-offs

- **依赖体积**：GSAP（及可选 Lottie）会增加打包体积；可通过按需引入 GSAP 插件与 Lottie 懒加载缓解。
- **移动端 hover**：弧形展开当前以 hover 触发；移动端需考虑点击主图标展开/收起子图标，与需求不冲突，实现时兼容触摸即可。

## Migration Plan

1. 在 Settings 页面增加「数据过期」配置区块（或卡片），并从 Settings 页移除仅含数据过期的右下角悬浮面板。
2. 新增奖惩列表、人员名单的存储 key 与读写 API，再在 Settings 中增加对应配置 UI。
3. 在根布局挂载全局右下角浮动组件，实现主图标 + hover 弧形子图标，子图标点击打开蒙版并传入类型（抽人/奖惩）。
4. 实现蒙版 + 卡牌组件：轮播 → 3 张定格 → 用户选一张 → 三张翻开显示内容 → 选中张高亮浮动；数据从 storage 读取（人员名单 / 奖惩列表）。
5. 引入 GSAP（及按需 Lottie），将轮播、翻牌、高亮动效接入上述流程。

无需数据迁移；旧版若存在「数据过期」的本地 key，保持不变即可。

## Clarifications (需求澄清结果)

- **名单/奖惩不足 3 条**：采用「必须至少 3 条才可抽」。名单或奖惩条目不足 3 条时，点击「抽人」或「奖惩」不进入蒙版，仅提示「请先在设置中配置至少 3 条人员/奖惩」。
- **奖惩数据结构与展示**：奖惩共用一个列表，每条带类型（奖励/惩罚）+ 文字描述；3 张卡牌从该列表纯随机抽取。Settings 配置表格内用 tag 区分：奖励用绿色 tag，惩罚用红色 tag。
- **Settings 内年会配置入口**：采用一个「年会/活动」卡片（与游戏卡片并列）；点击进入后在同一页或子页内提供数据过期、随机奖惩、随机抽人三个区块（可折叠或 Tab）。
- **蒙版关闭与再来一次**：选完一张并高亮展示后，蒙版保持打开，仅通过点击右上角叉号关闭；蒙版内不提供「再来一次」按钮，需要再抽时先关闭蒙版再点浮动入口。
- **浮动装置显示范围**：所有页面（首页、各游戏页、Settings 及子页）均显示右下角浮动装置；便于在 Settings 配完名单/奖惩后直接试抽。
- **定格 3 张不重复**：抽人时 3 张对应 3 个不同的人，奖惩时 3 张对应 3 条不同条目；从名单/列表中无放回随机抽取 3 个。

## Open Questions

- 无。若后续需要限制「仅 Settings 页显示浮动装置」，可在实现阶段在根组件内按路由条件渲染。
