# Design: 国际化（i18n）方案

## Context

- 项目为 Vue 3 + TypeScript + Vite 纯前端游戏平台，无后端；当前所有 UI 文案为硬编码中文。
- 需求：支持多语言（至少中文、英文），用户可切换语言，偏好持久化；后续可扩展更多语言。
- 约束：不改变路由与业务逻辑；不改变数据存储结构；仅将“展示用字符串”改为由 i18n 提供。

## Goals / Non-Goals

- **Goals**：应用内所有用户可见文案通过 i18n 输出；支持中文（默认）与英文；提供语言切换入口；语言偏好持久化到本地；游戏标题/描述等配置文案与组件文案统一走 i18n。
- **Non-Goals**：不实现服务端语言检测或按地区自动分发；游戏内展示的数据（城市名、英雄名、电影名、物品名等）由管理者配置，不纳入平台 i18n 范围。

## 澄清结论（需求确认）

与产品确认后的边界与策略，实现与验收以此为准：

| 维度 | 结论 |
|------|------|
| **游戏数据** | 不纳入平台 i18n；游戏内数据由管理者在设置中配置，平台只做界面国际化。 |
| **首次访问语言** | 不检测浏览器语言，一律默认中文（zh-CN）；用户手动切换后再持久化。 |
| **语言切换入口** | 仅在导航栏（Navigation）提供一处语言切换，全局只此入口。 |
| **缺失 key 表现** | 先回退到 zh-CN 同一 key，若仍无则显示 key 字符串；与 fallbackLocale 一致。 |
| **复数形式** | 首轮用插值（如 `{ count }`）显示数字，不实现复数规则；后续可再加。 |

## Decisions

### 1. i18n 库选型

- **决策**：采用 `vue-i18n`（Vue 3 兼容版本，如 `vue-i18n@9`）。
- **理由**：与 Vue 生态集成最好，支持 Composition API（`useI18n()`）、模板内 `$t()`、懒加载 locale；社区与文档成熟。
- **备选**：自定义简单 key-value + reactive locale — 需自行处理复数、插值、持久化与全局注入，维护成本高，不采纳。

### 2. 语言包与目录结构

- **决策**：语言包按语言代码分文件存放（如 `src/locales/zh-CN.json`、`src/locales/en.json`），公共结构按功能/页面划分 key 命名空间（如 `common.*`、`home.*`、`games.*`、`settings.*`）；i18n 初始化与 `createI18n` 放在 `src/locales/index.ts`（或 `src/i18n/index.ts`），在 `main.ts` 中 `app.use(i18n)`。
- **理由**：JSON 便于非开发参与翻译；按命名空间便于按需懒加载（若后续包体过大）；单一入口便于设置 fallbackLocale、默认 locale。
- **备选**：单一大 JSON — 不利于按模块维护；TS 对象 — 非开发不友好，不采纳为首选。

### 3. 默认语言与持久化

- **决策**：默认语言为中文（`zh-CN`）；不检测浏览器语言，首次访问一律使用 zh-CN；用户切换后的语言写入 localStorage（如 key `app-locale`），应用启动时读取并设为当前 locale；若未设置或无效则使用 `zh-CN`。
- **理由**：与当前产品主要用户一致；年会/团建多为固定设备，默认中文即可；localStorage 与现有“纯前端、本地存储”一致。
- **备选**：首次根据浏览器语言初判 — 增加逻辑与测试场景，不采纳。不持久化 — 每次刷新恢复默认，体验差，不采纳。

### 4. 语言切换入口

- **决策**：仅在导航栏（Navigation）提供语言切换控件（如下拉、中/英切换按钮），全局只此一处入口；切换后调用 i18n 的 `locale` 赋值并写入 localStorage，界面即时更新。
- **理由**：入口统一、易发现；导航在所有页面可见，切换后整站即时生效；实现与维护简单。
- **备选**：导航 + 设置页双入口 — 增加维护；仅放在 Settings 页 — 发现性与便利性差，不采纳。

### 5. 游戏配置中的标题与描述

- **决策**：`src/config/games.ts` 中游戏的 `title`、`description` 改为 i18n 的 key（如 `games.city.title`），在组件或路由层通过 `t()` 解析；或在运行时从 i18n 消息中读取对应 key 填充到游戏列表。不保留中文硬编码在 config 内。
- **理由**：游戏列表是核心展示内容，须与所选语言一致；统一走 i18n 便于维护与扩展。
- **备选**：config 仍为中文，仅在展示时用 key 覆盖 — 易产生两套来源，不采纳。

### 6. 文案抽取范围

- **决策**：首轮覆盖所有面向用户的界面文案：首页、导航、设置、各游戏页与通用组件（按钮、提示、表单项标签、统计文案等）；命令式调用（如 `GameNotify`、`GameModal.alert`）中的 message 与 title 改为传入 i18n key 或在调用处使用 `t()` 得到字符串后传入。游戏内展示的数据名称由管理者配置，不纳入平台 i18n。
- **理由**：保证整站界面语言一致；数据为管理者可配置内容，平台只做界面国际化。
- **备选**：仅首页与导航 — 其余仍中文，体验不完整，不采纳。

### 7. 缺失 key 与复数形式

- **决策**：缺失 key 时先回退到 fallbackLocale（zh-CN），若仍无则显示 key 字符串。首轮统计类文案用插值（如 `$t('home.totalWins', { count })`）显示数字，不实现 "1 win" / "2 wins" 等复数规则，后续可再加。
- **理由**：用户尽量看到可读内容；实现简单，为后续复数留口子。

## Risks / Trade-offs

- **包体积**：vue-i18n 与多语言 JSON 会略增体积；可通过按需加载部分 locale 或拆分命名空间懒加载缓解。
- **遗漏与回归**：抽取过程中可能遗漏文案或误改逻辑；需依赖人工检查与构建通过、关键页面走查。

## Migration Plan

1. 安装 vue-i18n，在 `src/locales/` 下新增 `index.ts` 与 `zh-CN.json`、`en.json`（可先占位少量 key）。
2. 在 `main.ts` 中注册 i18n，并从 localStorage 恢复上次语言。
3. 在 Navigation（或全局布局）增加语言切换 UI，切换时更新 locale 并持久化。
4. 按模块（home → settings → 各游戏 → 通用组件）逐步将硬编码中文替换为 `$t('key')` 或 `useI18n().t('key')`，并同步维护 zh-CN / en 的 JSON。
5. 将 `games.ts` 中 title/description 改为使用 i18n key，展示处通过 t() 取值。
6. 全站走查、构建与类型检查通过，确认无硬编码中文残留（可按需加简单 lint 或脚本辅助检查）。

## Open Questions

- 无；游戏数据多语言已明确不纳入本次范围，由管理者在设置中配置。
