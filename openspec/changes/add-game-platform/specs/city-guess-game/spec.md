## ADDED Requirements

### Requirement: 城市随机选择
系统 SHALL 从主要城市列表（100-150个，包含省会、直辖市、计划单列市、知名地级市）中随机选择一个目标城市。

#### Scenario: 开始新游戏
- **WHEN** 用户开始城市猜测游戏
- **THEN** 系统从主要城市列表中随机选择一个城市作为目标
- **AND** 目标城市对用户隐藏
- **AND** 城市数据包含名称和经纬度坐标

### Requirement: 猜测输入
系统 SHALL 提供下拉联想输入框（autocomplete）供用户输入猜测的城市名称，最多提供 5 次猜测机会。

#### Scenario: 用户输入猜测（有效输入）
- **WHEN** 用户在下拉联想输入框中输入城市名称
- **THEN** 系统显示匹配的城市列表供选择
- **AND** 用户选择或输入有效城市名称并提交
- **THEN** 系统验证输入是否在数据库中
- **AND** 如果有效，消耗一次猜测机会

#### Scenario: 用户输入猜测（无效输入）
- **WHEN** 用户输入的城市名称不在数据库中
- **THEN** 下拉框显示提示："该城市不在游戏范围内，请输入主要城市（如省会、直辖市等）"
- **AND** 提交按钮被禁用，无法提交
- **AND** 不消耗猜测机会

### Requirement: 距离和方位提示
系统 SHALL 在每次猜测后显示目标城市与猜测城市之间的距离和方位。

#### Scenario: 显示距离和方位
- **WHEN** 用户提交有效猜测后
- **THEN** 系统计算并显示距离（格式：XX 公里）
- **AND** 显示方位（格式：目标城市在猜测城市的 XX 方向）
- **AND** 方位包括：东、南、西、北、东北、东南、西北、西南

### Requirement: 初始提示
系统 SHALL 在游戏开始时显示目标城市的一个特点作为初始提示。

#### Scenario: 显示初始提示
- **WHEN** 用户开始城市猜测游戏
- **THEN** 系统在游戏说明下方显示一个醒目的提示卡片
- **AND** 提示卡片显示目标城市的一个特点（如：省会城市、沿海城市、历史名城等）
- **AND** 提示卡片始终可见，不可隐藏

### Requirement: 城市特点提示
系统 SHALL 在每次猜测后显示目标城市的一个新特点，初始提示计入提示序列。

#### Scenario: 显示城市特点
- **WHEN** 用户提交有效猜测后
- **THEN** 系统显示目标城市的一个新特点（如：省会城市、沿海城市、历史名城等）
- **AND** 每次猜测显示的特点不重复
- **AND** 初始提示的特点不会在后续猜测中重复显示
- **AND** 总共显示5个特点（1个初始提示 + 4个猜测后提示）

### Requirement: 游戏成功
系统 SHALL 在用户正确猜测目标城市时判定游戏成功。

#### Scenario: 猜测成功
- **WHEN** 用户输入的城市名称与目标城市匹配
- **THEN** 系统显示成功消息
- **AND** 游戏结束
- **AND** 提供重新开始游戏的选项

### Requirement: 游戏失败
系统 SHALL 在用户用尽 5 次猜测机会仍未猜中时判定游戏失败。

#### Scenario: 猜测失败
- **WHEN** 用户已使用 5 次猜测机会且未猜中
- **THEN** 系统显示失败消息并揭示目标城市
- **AND** 游戏结束
- **AND** 提供重新开始游戏的选项

### Requirement: 距离计算
系统 SHALL 使用内置的城市经纬度数据，通过 Haversine 公式本地计算两点间的直线距离。

#### Scenario: 计算距离
- **WHEN** 系统需要计算两个城市间的距离
- **THEN** 使用内置在 JSON 中的经纬度数据
- **AND** 使用 Haversine 公式在客户端本地计算距离
- **AND** 结果以公里为单位，保留整数或一位小数
- **AND** 无需调用外部 API

### Requirement: 方位计算
系统 SHALL 基于内置的城市经纬度数据，在客户端本地计算方位角。

#### Scenario: 计算方位
- **WHEN** 系统需要计算目标城市相对于猜测城市的方位
- **THEN** 使用内置在 JSON 中的经纬度数据
- **AND** 在客户端本地计算方位角
- **AND** 将方位角转换为八个方向之一（东、南、西、北、东北、东南、西北、西南）
- **AND** 无需调用外部 API

### Requirement: 游戏状态持久化
系统 SHALL 使用 sessionStorage 保存游戏状态，支持页面刷新后恢复进度。

#### Scenario: 保存游戏状态
- **WHEN** 用户进行游戏（选择目标、提交猜测等）
- **THEN** 系统将当前游戏状态保存到 sessionStorage
- **AND** 保存内容包括：目标城市、已猜测次数、猜测历史记录

#### Scenario: 恢复游戏状态
- **WHEN** 用户刷新页面
- **THEN** 系统从 sessionStorage 读取游戏状态
- **AND** 恢复目标城市、已猜测次数和猜测历史
- **AND** 用户可以继续之前的游戏

#### Scenario: 重新开始游戏
- **WHEN** 用户关闭标签页后重新打开
- **THEN** sessionStorage 自动清除
- **AND** 游戏重新开始，随机选择新的目标城市
